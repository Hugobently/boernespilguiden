// Prisma schema for Børnespilguiden
// PostgreSQL database for Vercel deployment

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============================================================================
// SUPPORTED LANGUAGES
// ============================================================================
// da = Danish (default), en = English, fr = French, es = Spanish

// ============================================================================
// GAME TRANSLATIONS
// ============================================================================

// Translations for digital games
model GameTranslation {
  id               String @id @default(cuid())
  gameId           String
  locale           String // "da", "en", "fr", "es"

  // Translated content
  title            String
  description      String
  shortDescription String
  pros             String @default("[]") // JSON array of translated pros
  cons             String @default("[]") // JSON array of translated cons
  parentTip        String?

  // Relations
  game             Game   @relation(fields: [gameId], references: [id], onDelete: Cascade)

  @@unique([gameId, locale])
  @@index([locale])
}

// Translations for board games
model BoardGameTranslation {
  id               String    @id @default(cuid())
  boardGameId      String
  locale           String // "da", "en", "fr", "es"

  // Translated content
  title            String
  description      String
  shortDescription String
  pros             String    @default("[]") // JSON array
  cons             String    @default("[]") // JSON array
  parentTip        String?

  // Relations
  boardGame        BoardGame @relation(fields: [boardGameId], references: [id], onDelete: Cascade)

  @@unique([boardGameId, locale])
  @@index([locale])
}

// ============================================================================
// DIGITAL GAMES
// ============================================================================

// Digitale spil
model Game {
  id                String   @id @default(cuid())
  title             String
  slug              String   @unique
  description       String   // Vores egen review-tekst
  shortDescription  String   // Til cards (max 150 tegn)

  // Aldersgruppe
  minAge            Int
  maxAge            Int
  ageGroup          String   // "0-3", "3-6", "7+"

  // Kategorier og tags (JSON strings)
  categories        String   @default("[]") // ["læring", "eventyr", "puslespil", "kreativ", "action"]
  skills            String   @default("[]") // ["matematik", "læsning", "logik", "motorik", "sprog"]
  themes            String   @default("[]") // ["dyr", "rummet", "prinsesser", "dinosaurer"]
  targetGender      String   @default("alle") // "alle", "drenge", "piger"

  // Platform info (JSON strings)
  platforms         String   @default("[]") // ["iOS", "Android", "PC", "Nintendo", "PlayStation"]
  appStoreUrl       String?
  playStoreUrl      String?
  websiteUrl        String?

  // Forældreinfo (VIGTIGT for din side!)
  hasAds            Boolean  @default(false)
  hasInAppPurchases Boolean  @default(false)
  isOfflineCapable  Boolean  @default(false)
  requiresInternet  Boolean  @default(false)
  dataCollection    String?  // "ingen", "minimal", "moderat", "omfattende"

  // Dybdegående forældreinfo (fra indholdsstrategi)
  parentInfo        String?  // "Hvad forældre skal vide" - længere tekst (100-150 ord)
  hasSocialFeatures Boolean  @default(false)
  hasChat           Boolean  @default(false)
  hasNotifications  Boolean  @default(false)
  hasManipulativeDesign Boolean @default(false) // FOMO, streaks, etc.
  hasScaryContent   Boolean  @default(false)
  isCoppaCompliant  Boolean  @default(true)
  requiresReading   Boolean  @default(false)
  typicalSessionMinutes Int? // Typisk spilletid pr. session

  // Sprog
  supportsDanish    Boolean  @default(false) // Om spillet har dansk tekst/tale

  // Pris
  price             Float    @default(0)
  priceModel        String   // "gratis", "engangskøb", "abonnement", "freemium"

  // Vores vurdering
  rating            Float    // 1-5
  pros              String   @default("[]") // JSON array
  cons              String   @default("[]") // JSON array
  parentTip         String?  // Tip til forældre

  // Media
  iconUrl           String?
  screenshots       String   @default("[]") // JSON array
  videoUrl          String?

  // Developer info
  developerName     String?

  // Affiliate (til senere)
  affiliateUrl      String?
  affiliateProvider String?  // "apple", "google", "amazon"

  // Meta
  featured          Boolean  @default(false)
  editorChoice      Boolean  @default(false)
  createdAt         DateTime @default(now())
  updatedAt         DateTime @updatedAt

  // Translations relation
  translations      GameTranslation[]
}

// ============================================================================
// BOARD GAMES
// ============================================================================

// Brætspil
model BoardGame {
  id               String   @id @default(cuid())
  title            String
  slug             String   @unique
  description      String
  shortDescription String

  // Aldersgruppe
  minAge           Int
  maxAge           Int
  ageGroup         String

  // Spilinfo
  minPlayers       Int
  maxPlayers       Int
  playTimeMinutes  Int
  complexity       Int      // 1-5 (1=meget let, 5=kompleks)

  // Kategorier (JSON strings)
  categories       String   @default("[]") // ["strategi", "samarbejde", "læring", "fest", "kort"]
  skills           String   @default("[]")
  themes           String   @default("[]")
  targetGender     String   @default("alle")

  // Sprog
  supportsDanish   Boolean  @default(false) // Om spillet har dansk tekst/tale

  // Pris og køb
  price            Float?
  affiliateUrl     String?
  amazonUrl        String?

  // Vurdering
  rating           Float
  pros             String   @default("[]") // JSON array
  cons             String   @default("[]") // JSON array
  parentTip        String?

  // Media
  imageUrl         String?

  // Meta
  featured         Boolean  @default(false)
  editorChoice     Boolean  @default(false)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  // Translations relation
  translations     BoardGameTranslation[]
}

// ============================================================================
// ANALYTICS
// ============================================================================

model AnalyticsEvent {
  id        String   @id @default(cuid())
  type      String   // "page_view", "game_click", "affiliate_click", "search_query", etc.
  sessionId String?
  data      String   // JSON data
  timestamp DateTime @default(now())

  @@index([type])
  @@index([timestamp])
  @@index([sessionId])
}

// Popular search queries (aggregated)
model SearchQuery {
  id        String   @id @default(cuid())
  query     String   @unique
  count     Int      @default(1)
  lastUsed  DateTime @default(now())
  createdAt DateTime @default(now())

  @@index([count])
  @@index([lastUsed])
}

// ============================================================================
// FILM & SERIER
// ============================================================================

model Media {
  id              String   @id @default(cuid())

  // Identifiers - kun én af disse vil være sat
  tmdbId          Int?     @unique
  drEntityId      String?  @unique

  // Basis info
  type            String // "MOVIE" or "SERIES" - SQLite compatible
  title           String
  originalTitle   String?
  slug            String   @unique

  // Indhold
  description     String?  @db.Text
  review          String?  @db.Text

  // Billeder
  posterUrl       String?
  backdropUrl     String?

  // Metadata
  releaseDate     DateTime?
  runtime         Int?      // minutter
  ageMin          Int?      // Minimum alder
  ageMax          Int?      // Maximum alder
  genres          String[]
  seasons         Int?      // Antal sæsoner (kun serier)

  // Klassifikation
  source          String // "TMDB", "DR_MANUAL", or "MANUAL" - SQLite compatible
  isDanish        Boolean  @default(false)
  isNordic        Boolean  @default(false)

  // Sprog information
  hasDanishAudio     Boolean? // Har dansk tale
  hasDanishSubtitles Boolean? // Har danske undertekster
  availableLanguages String[] @default([]) // Liste af tilgængelige sprog-koder

  // Relationer
  streamingInfo   StreamingInfo[]

  // Status
  isActive        Boolean  @default(true)
  isReviewed      Boolean  @default(false)
  isFeatured      Boolean  @default(false)

  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt

  @@index([type, isActive])
  @@index([source])
  @@index([ageMin, ageMax])
  @@index([isDanish])
}

model StreamingInfo {
  id          String   @id @default(cuid())
  mediaId     String
  media       Media    @relation(fields: [mediaId], references: [id], onDelete: Cascade)

  provider    String   // "netflix", "disney", "drtv", etc.
  providerId  Int?     // TMDB provider ID (null for DRTV)
  available   Boolean  @default(true)
  url         String?  // Deep link
  isFree      Boolean  @default(false)

  lastChecked DateTime @default(now())

  @@unique([mediaId, provider])
  @@index([provider, available])
}

// MediaType and MediaSource are now String fields for SQLite compatibility
// Values: type: "MOVIE" | "SERIES"
// Values: source: "TMDB" | "DR_MANUAL" | "MANUAL"
